---
title: "過去問を仕分けするwebアプリを作った話"
date: 2020-12-16
category: 技術系
tags:
  - アドベントカレンダー
  - 作ったもの
---

::: tip
この記事ははてなブログから引っ越ししました。もとの記事は[コチラ](https://ohyama4z.hatenablog.com/entry/2020/12/16/000901)
:::

- この記事は[苫小牧高専アドベントカレンダー 2020](https://adventar.org/calendars/5574) 16 日目の記事です

[https://adventar.org/calendars/5574:embed:cite]

## 自己紹介

はじめまして、おおやま([@ohyama4z](https://twitter.com/ohyama4z))です。

[とある男](https://twitter.com/satakenkoki)にｶｲﾊﾂ沼に沈められて、去年のアドベントカレンダーでこんな記事も書いてからはや一年ですが、今年も彼は僕を沼から逃げさせてはくれませんでしたね

[https://ohyama4z.hatenablog.com/entry/2019/12/16/010905:embed:cite]

そんなわけで、至らないところもあるかもしれませんが、文句は**とある男に**言ってください

## これを見る苫小牧高専教員の皆さんへ

この記事は**過去問**についてガンガン触れて書いているように見えるでしょう。しかし、<u>この記事はフィクションで、あくまで個人的な見解で組織としてのものではなく、部屋を明るくして画面から十分に離れて見ていただき、出てくる食品はあとでスタッフが美味しくいただきます...</u>

<br><br>...**ごめんなさい、怒らないでください、お願いします**

## キミは過去問を知ってるか

皆さんは**過去問**という存在を知ってるでしょうか

> 過去問、それは先祖代々引き継がれ、多くの学生達の命を救い、今日まで信仰されている存在。
> (ヨハネの黙示録第 9 章より)

そうですね、古事記とかにも書かれているあの過去問ですね。

学生達はテスト前になると必死になって過去問を集めようとします。

<u>彼らは血眼で学校内・寮内を駆け回り、上級生に媚を売り、SNS などで詰め寄り、ワイロ(食料)を握らせ、過去問を手に入れます。</u>

今回作ったのは、そうして集めた大量の過去問を年度・教科・用紙の種類などで簡単に仕分ける web アプリです。

## 今までの過去問の管理の方法について

作った web アプリの紹介の前に、今までどのように過去問を管理していたか話す必要があります。

過去問が大量に集まり、共有する輪も広がるにつれて過去問の仕分けを人の手でさばけるほどでなくなってきました。

そこで、某氏らが作ってくれた<u>kakomon-manager-legacy</u>で管理し始めました。([github](https://github.com/satackey/kakomon-manager-legacy))

<figure class="figure-image figure-image-fotolife" title="kakomon-manager-legacy">[f:id:ohyama4z:20201215004429p:plain]<figcaption>kakomon-manager-legacy</figcaption></figure>

git[^2]でスキャンした画像ファイルと、過去問の情報を記載した csv を管理し、git にある csv をもとに google drive に同期するといったものです。

実際にこれを使った結果 google drive 上では以下のように教科ごとのディレクトリが作られ、ファイル名[^1]もわかりやすいように仕分けされます。

<figure class="figure-image figure-image-fotolife" title="ディレクトリ">[f:id:ohyama4z:20201215005619p:plain]<figcaption>ディレクトリ</figcaption></figure>
<figure class="figure-image figure-image-fotolife" title="各ファイル">[f:id:ohyama4z:20201215005549p:plain]<figcaption>各ファイル</figcaption></figure>

### 発生した問題

コレ自体はすごく便利なんですけども、1 つ問題が発生しました。それは、**過去問をアップロードするハードルが高い**ということです。

上の説明図を見てもらうだけでも

- kakomon-manager-legacy の要件に合わせて csv の編集をする[^3]
- git を使う
- circleCI がエラーを吐いた場合に対処する

などなどとても「ハイ、これ使って過去問ガンガン追加してね」って感じでみんなに使ってもらえるものではありませんでした。

これにより、**大量の過去問を少数のハードルを越えた者だけがさばく**という地獄が発生、<u>過去問の仕分けの負担が重すぎてテストがままならない</u>
なんていう逆転現象が起こっていました。

そこで、**誰でも簡単にこの仕分け作業ができるサービス**の需要が生まれ、web アプリの作成に取り掛かりました。

# 本題

前置きが長くなりましたね。

ここからが作った web アプリ**「KMS(過去問マネージメントシステム)」**(以下 KMS)の紹介です([github](https://github.com/ohyama4z/Kakomon-Management-System))

## 概要

KMS の役割は、ファイルの追加/編集時の git とユーザの橋渡しとなる web アプリです

<figure class="figure-image figure-image-fotolife" title="Kakomon-Management-System">[f:id:ohyama4z:20201215141907p:plain]<figcaption>Kakomon-Management-System</figcaption></figure>

netlify の[Git Gateway](https://github.com/netlify/git-gateway)を使ってホストし、web から git commit や情報取得をできるようにしています。
このため<u>git のコマンドを一切知らなくても過去問の編集ができます。</u>

csv の編集時には、セレクトボックス等で kakomon-manager-legacy の要件に合う入力に合わせることで、<u>csv の記述のミスによる circleCI のビルド落ちを無くし</u>、誰でも編集できるようにしています。

## 実際の見た目

[http://kakomo.netlify.app]

↑ こちら[^4]で公開してますが、
過去問の管理というプライベートなあれなので、権限が無いユーザ[^6]はローディング表示をずっと見せられるだけのサイトになっています(?)

### アップロード画面

<figure class="figure-image figure-image-fotolife" title="アップロード画面">[f:id:ohyama4z:20201215131328p:plain]<figcaption>アップロード画面</figcaption></figure>

過去問のアップロードを行います、新規ブランチの作成もここでできるようにしています。

が、Git Gateway 側の nginx の設定でアップロードできるファイルのサイズ上限が小さく、<u>スキャンした画像ファイルがサイズ上限に引っかかり、上げられない事態が発生</u>

**これが判明したのは 9 割方完成したあと**だったので本当に、出ました。**" 涙 "**が

やむなく現在は使用を中断しています[^5]

### 編集画面

<figure class="figure-image figure-image-fotolife" title="編集画面">[f:id:ohyama4z:20201215133105p:plain]<figcaption>編集画面</figcaption></figure>

<u>すでに情報が入力されている csv の編集、またはアップロードがされて情報がまだ入力されていない csv の中身の記入</u>をここで行います。

実際に動かしてる様子が以下のデモ

[https://twitter.com/ohyama4z/status/1338700064886202370:embed]

[vue-sidebar-menu](https://github.com/yaminncco/vue-sidebar-menu)をつかってファイルツリーを実装したんですがオシャレですね(自画自賛)

結構ここらへんの UI は配慮しながら書いたつもりなんですが、実際に友人に使ってもらっての意見を聞いてみると、
意外とまだまだ改善の余地だらけでホント UI づくりって難しいなと思ったり思わなかったりしました。

## おわり

今回作った web アプリの紹介は以上です。

拙い文章だったかもしれませんが、ここまで読んでいただきありがとうございました。

## あとがき

ぶっちゃけた話、**これまだ完成してません**。

このプロジェクトに取り掛かり始めたのが今年の 7 月終わり頃なのですが、まだ「誰でもすんなり使ってもらう」というテーマに至るほど配慮カンペキな web アプリとはなっていません。
しかし、以前より圧倒的にハードルが下がってるのも確かなので過去問の管理がより手軽になりましたね。

今回の web アプリを作るにあたって、僕一人で作ったわけではありません。

僕と一緒に作ってくれた[友人](https://twitter.com/asann__A)と、わかんないことを 150 割教えてくれる[ある男](https://twitter.com/satakenkoki)(こいつはホントに何者なんでしょうか...(褒め言葉))
に本当に感謝します。ありがとう

これ以上、過去問についての記事を書いていると明日から**教員の殺意**を背中に受けることになりそうなのでこの辺にしておきます。

改めて、ここまで読んでいただきありがとうございました。

[^1]: 伏せているのは担当教員名です
[^2]: この実際の過去問が入っているリポジトリは無論プライベートです。
[^3]: 詳しくは[kakomon-manager-legacy](https://github.com/satackey/kakomon-manager-legacy)の README を参照
[^4]: ドメインがダサいって?僕もそう思います。
[^5]: ローカルでは nginx の設定を変更できるので、開発環境でなら nginx のファイルサイズ上限を変更し KMS 経由でアップロードできますが、そんなことでは僕の涙は止められません。
[^6]: ここで言う権限は git-gateway の認証設定の話で僕が権限を割り振りできます。
